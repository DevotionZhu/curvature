#!/usr/bin/env python
# -*- coding: UTF-8 -*-

import os
import sys

# Add our parent folder to our path
sys.path.insert(0, os.path.dirname(os.path.dirname(__file__)))

import codecs
import msgpack
import pprint

# Set our output to default to UTF-8
reload(sys)
sys.setdefaultencoding('utf-8')
sys.stderr = codecs.getwriter('utf8')(sys.stderr)
# sys.stdout = codecs.getwriter('utf8')(sys.stdout)

unpacker = msgpack.Unpacker(sys.stdin, use_list=True)
ways = []
ways_seen = []
coords = []
coords_seen = []
for collection in unpacker:
    for way in collection['ways']:
        if not way['id'] in ways_seen:
            ways.append((way['id'], way['tags'], way['refs']))
            ways_seen.append(way['id'])

            for i, ref in enumerate(way['refs']):
                if not ref in coords_seen:
                    coords.append((ref, way['coords'][i][0], way['coords'][i][1]))
                    coords_seen.append(ref)

pp = pprint.PrettyPrinter(indent=4)
pp.pprint(ways)
pp.pprint(coords)
